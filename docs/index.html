<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blackboard Bookmarklets</title>
<link rel="stylesheet" href="groovy_index.css">
</head>
<body>
<header>
  <h1>Blackboard Bookmarklets</h1>
  <a href="https://github.com/jkelley-blackboard/blackboard-bookmarklets" target="_blank">View Repository</a>
</header>

<section class="note">
  <strong>About Bookmarklets:</strong>
  <ul>
    <li><strong>Fragility:</strong> They rely on Blackboard's structure and may break after updates.</li>
    <li><strong>Risk:</strong> Bookmarklets execute JS directly; only use trusted sources.</li>
    <li><strong>Flexibility:</strong> Drag links to your bookmarks bar and use them on Blackboard pages.</li>
  </ul>
</section>

<section class="instructions note">
  <strong>To install:</strong> Drag a link below to your bookmarks bar.
</section>

<div id="bookmarklet-sections"></div>

<footer>
  &copy; 2025 Anthology Inc. All rights reserved.
</footer>

<script>
const repoUser = "jkelley-blackboard";
const repoName = "blackboard-bookmarklets";
const branch = "main";
const jsonPath = "bookmarklets.json";

// Fetch bookmarklets.json
fetch(jsonPath)
  .then(res => res.json())
  .then(bookmarklets => {
    const categories = {};
    bookmarklets.forEach(bm => {
      if (!categories[bm.category]) categories[bm.category] = [];
      categories[bm.category].push(bm);
    });

    const container = document.getElementById("bookmarklet-sections");
    Object.entries(categories).forEach(([cat, bms]) => {
      const section = document.createElement("section");
      section.id = cat.replace(/\s+/g,"-");
      const h2 = document.createElement("h2");
      h2.textContent = cat;
      section.appendChild(h2);

      const grid = document.createElement("div");
      grid.className = "grid";

      bms.forEach(bm => {
        const link = document.createElement("a");
        link.className = "bookmarklet";
        link.textContent = bm.label;
        link.title = bm.description;
        link.target = "_blank"; // required by some browsers for dragging

        // Fetch the JS code and set as href
        fetch(`https://raw.githubusercontent.com/${repoUser}/${repoName}/${branch}/${bm.path}`)
          .then(res => res.text())
          .then(code => link.href = `javascript:${code.trim()}`)
          .catch(err => console.error("Error loading bookmarklet:", bm.label, err));

        grid.appendChild(link);
      });

      section.appendChild(grid);
      container.appendChild(section);
    });
  })
  .catch(err => console.error("Error loading bookmarklets.json:", err));
</script>
</body>
</html>
