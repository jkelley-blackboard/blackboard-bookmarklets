<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blackboard Bookmarklets</title>
  <link rel="stylesheet" href="groovy_index.css">
  <script src="https://cdn/npm/marked/marked.min.js</script>
  <style>
    #readmeModal {
      display: none;
      position: fixed;
      top: 10%;
      left: 10%;
      width: 80%;
      height: 80%;
      background: white;
      border: 1px solid #ccc;
      padding: 20px;
      overflow: auto;
      z-index: 10000;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    #readmeModal button {
      float: right;
      margin-bottom: 10px;
    }
    #readmeContent {
      font-family: sans-serif;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-container">
      <h1>Blackboard Bookmarklets</h1>
      <a href="https://github.com/jkelley-blackboard/DDA" target="_blank">View Repository</a>
    </div>
  </header>
  <div class="main-wrapper">
    <aside class="sidebar">
      <h3>Categories</h3>
      <ul id="category-links"></ul>
    </aside>
    <main class="content">
      <section class="note">
        <strong>About Bookmarklets:</strong>
        <ul>
          <li><strong>Fragility:</strong> They rely on Blackboard's structure and may break after updates.</li>
          <li><strong>Risk:</strong> Execute JavaScript directly; only use trusted sources.</li>
          <li><strong>Flexibility:</strong> Drag links to your bookmarks bar and use on Blackboard pages.</li>
        </ul>
      </section>
      <section class="instructions note">
        <strong>To install:</strong> Drag a link below to your bookmarks bar.
      </section>
      <div id="bookmarklet-sections"></div>
      <div class="disclaimer note">
        <strong>Disclaimer:</strong> These bookmarklets are experimental and provided as-is. Use at your own risk.
      </div>
    </main>
  </div>
  <footer>
    Â© 2025 Anthology Inc. All rights reserved.
  </footer>

  <!-- Modal for README -->
  <div id="readmeModal">
    <button onclick="closeModal()">Close</button>
    <div id="readmeContent"></div>
  </div>

  <script>
    const repoUser = "jkelley-blackboard";
    const repoName = "blackboard-bookmarklets";
    const branch = "main";
    const jsonPath = "bookmarklets.json";

    function showReadme(folder) {
      const url = `https://raw.githubusercontent.com/${repoUser}/${repoName}/${branch}/${folder}/README.md`;
      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error("README not found");
          return res.text();
        })
        .then(text => {
          document.getElementById("readmeContent").innerHTML = marked.parse(text);
          document.getElementById("readmeModal").style.display = "block";
        })
        .catch(err => {
          document.getElementById("readmeContent").innerHTML = "<p><strong>Error loading README.md</strong></p>";
          document.getElementById("readmeModal").style.display = "block";
        });
    }

    function closeModal() {
      document.getElementById("readmeModal").style.display = "none";
    }

    fetch(jsonPath)
      .then(res => res.json())
      .then(bookmarklets => {
        const categories = {};
        bookmarklets.forEach(bm => {
          if (!categories[bm.category]) categories[bm.category] = [];
          categories[bm.category].push(bm);
        });

        const categoryLinks = document.getElementById("category-links");
        const sectionsContainer = document.getElementById("bookmarklet-sections");

        Object.entries(categories).forEach(([cat, bms]) => {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = `#${cat.replace(/\\s+/g,"-")}`;
          a.textContent = cat;
          li.appendChild(a);
          categoryLinks.appendChild(li);

          const section = document.createElement("section");
          section.className = "section";
          section.id = cat.replace(/\\s+/g,"-");

          const h2 = document.createElement("h2");
          h2.textContent = cat;
          section.appendChild(h2);

          const grid = document.createElement("div");
          grid.className = "grid";

          bms.forEach(bm => {
            const container = document.createElement("div");
            container.style.display = "flex";
            container.style.alignItems = "center";
            container.style.gap = "8px";

            const link = document.createElement("a");
            link.className = "bookmarklet";
            link.textContent = bm.label;
            link.title = bm.description;
            link.target = "_blank";

            const rawUrl = `https://raw.githubusercontent.com/${repoUser}/${repoName}/refs/heads/${branch}/${bm.path}`;
            fetch(rawUrl)
              .then(res => {
                if (!res.ok) throw new Error(`File not found: ${bm.path}`);
                return res.text();
              })
              .then(code => link.href = `javascript:${encodeURIComponent(code.trim())}`)
              .catch(err => {
                console.error("Error loading bookmarklet:", bm.label, err);
                link.href = `javascript:alert('Bookmarklet not found: ${bm.label}')`;
              });

            container.appendChild(link);

            const readmeLink = document.createElement("a");
            readmeLink.textContent = "ðŸ“˜";
            readmeLink.style.fontSize = "0.9em";
            readmeLink.href = "#";
            readmeLink.onclick = () => {
              const folder = bm.path.split("/")[0];
              showReadme(folder);
              return false;
            };

            container.appendChild(readmeLink);
            grid.appendChild(container);
          });

          section.appendChild(grid);
          sectionsContainer.appendChild(section);
        });
      })
      .catch(err => console.error("Error loading bookmarklets.json:", err));
  </script>
</body>
</html>
