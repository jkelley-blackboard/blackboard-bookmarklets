javascript:(()=>{const f=document.querySelector('iframe[name="bb-base-admin-iframe"]');if(!f||!f.contentDocument){alert("⚠ Go to Admin > Users to manage role privileges.");return}const d=f.contentDocument;if(!d.location.pathname.includes("/webapps/blackboard/execute/managePrivileges")){const m=d.createElement("div");m.style="position:fixed;top:20px;background:#fff0f0;border:1px solid red;padding:10px;min-width:280px;z-index:9999;border-radius:6px;text-align:center;font-weight:bold;";m.innerHTML="⚠ Go to the manage privileges of a course or system role.";d.body.appendChild(m);m.style.left=((window.innerWidth-m.offsetWidth)/2)+"px";return}const pS="position:fixed;top:20px;z-index:9999;background:#fdfdfd;border:2px solid #666;border-radius:8px;padding:14px;cursor:move;min-width:350px;overflow:auto;box-shadow:3px 3px 8px rgba(0,0,0,0.25);font-family:sans-serif;",bS="margin:4px;padding:6px 14px;font-size:14px;border-radius:6px;border:1px solid #888;background:#f0f0f0;cursor:pointer;transition:all 0.2s;outline:none;",v=((()=>{const b=window.parent.document.querySelector("base[href*='/ultra/uiv']");if(!b)return"Unknown";const m=b.href.match(/uiv([\d\.]+-rel\.\d+)/);return m?m[1]:"Unknown"})());function mD(e){let x=0,y=0,oX=0,oY=0;e.onmousedown=function(a){a.preventDefault();x=a.clientX;y=a.clientY;d.onmouseup=()=>{d.onmouseup=null;d.onmousemove=null};d.onmousemove=function(a){a.preventDefault();oX=x-a.clientX;oY=y-a.clientY;x=a.clientX;y=a.clientY;e.style.top=(e.offsetTop-oY)+"px";e.style.left=(e.offsetLeft-oX)+"px"}}}const p=d.createElement("div");p.id="dlPanel";p.style=pS;d.body.appendChild(p);mD(p);p.style.left=((window.innerWidth-p.offsetWidth)/2)+"px";const dd=d.createElement("div");dd.id="details";p.appendChild(dd);const w=d.createElement("div");w.id="paginationWarning";p.appendChild(w);const bc=d.createElement("div");bc.id="buttonContainer";p.appendChild(bc);const u=new URLSearchParams(d.location.search),rT=u.get("type")||"Unknown",all=u.get("showAll")==="true";if(!all){w.innerHTML="⚠ Click Show All before downloading.";return}else w.innerHTML="";const h=d.querySelector("#pageTitleHeader"),rN=h?h.innerText.split(":").pop().trim():"Unknown",bb=location.hostname,t=new Date().toISOString();dd.innerHTML="<b>Role Type:</b>"+rT+"<br><b>bbDeployment:</b>"+bb+"<br><b>Role:</b>"+rN+"<br><b>Blackboard Version:</b>"+v+"<br><b>Timestamp:</b>"+t+"<hr>";function aB(l,h){const b=d.createElement("button");b.textContent=l;b.style=bS;b.onmouseover=()=>{b.style.background="#e0e0e0"};b.onmouseout=()=>{b.style.background="#f0f0f0"};b.onclick=h;bc.appendChild(b)}aB("Download JSON",()=>{const r=d.querySelectorAll("tbody#listContainer_databody>tr"),p={};r.forEach(tr=>{const n=tr.querySelector("th div"),nm=n?n.innerText.trim():null,e=tr.querySelector('input[type="checkbox"]'),ent=e?e.value:null,i=tr.querySelector("td:nth-child(2) img"),src=i?i.getAttribute("src"):"",s=src.includes("checkmark")?"permitted":src.includes("dash")?"inherited":"restricted";nm&&ent&&(p[nm.replace(/^"+|"+$/g,"")]={status:s,entitlement:ent})});const data={source:{roleType:rT,bbDeployment:bb,role:rN,timestamp:t,Bbversion:v},privileges:p},blob=new Blob([JSON.stringify(data)],{type:"application/json"}),a=d.createElement("a");a.href=URL.createObjectURL(blob);a.download="bb_"+rT.toLowerCase()+"_priv_"+rN.replace(/\s+/g,"_")+".json";a.click()});aB("Refresh Frame",()=>{f.contentWindow.location.reload()})})();
