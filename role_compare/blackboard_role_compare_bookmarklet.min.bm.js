javascript:(()=>{const iframe=document.querySelector('iframe[name="bb-base-admin-iframe"]');if(!iframe||!iframe.contentDocument){alert("⚠ Go to Admin > Users to manage role privileges.");return}const doc=iframe.contentDocument;if(!doc.location.pathname.includes("/webapps/blackboard/execute/managePrivileges")){alert("⚠ Go to the manage privileges of a course or system role.");return}const panelStyle="position:fixed;top:20px;z-index:9999;background:#ffffcc;border:4px solid black;border-radius:6px;padding:12px;cursor:move;min-width:320px;overflow:auto;box-shadow:2px 2px 6px rgba(0,0,0,0.2);";const buttonStyle="margin:4px;padding:6px 12px;font-size:14px;border-radius:4px;border:1px solid #666;background:#f9f9f9;cursor:pointer;transition:all 0.2s;outline:none;";const makeDraggable=el=>{let x1=0,y1=0,x2=0,y2=0;el.onmousedown=e=>{e.preventDefault();x2=e.clientX;y2=e.clientY;doc.onmouseup=()=>{doc.onmouseup=null;doc.onmousemove=null};doc.onmousemove=e=>{e.preventDefault();x1=x2-e.clientX;y1=y2-e.clientY;x2=e.clientX;y2=e.clientY;el.style.top=el.offsetTop-y1+"px";el.style.left=el.offsetLeft-x1+"px"}}};const panel=doc.createElement("div");panel.id="cmpPanel";panel.setAttribute("style",panelStyle);panel.innerHTML='<div id="paginationWarning"></div><div id="roleDetails"></div><div id="buttonContainer"></div><hr>';doc.body.appendChild(panel);makeDraggable(panel);panel.style.left=(window.innerWidth-panel.offsetWidth)/2+"px";const urlParams=new URLSearchParams(doc.location.search);const allShown=urlParams.get("showAll")==="true";const warnDiv=doc.getElementById("paginationWarning");warnDiv.innerHTML=allShown?"":"⚠ Click Show All before comparing.";if(!allShown)return;const buttonContainer=doc.getElementById("buttonContainer");const addButton=(label,handler)=>{const btn=doc.createElement("button");btn.textContent=label;btn.setAttribute("style",buttonStyle);btn.onclick=handler;buttonContainer.appendChild(btn)};addButton("Refresh Frame",()=>{iframe.contentWindow.location.reload()});addButton("Upload JSON",()=>{const input=doc.createElement("input");input.type="file";input.accept=".json";input.onchange=e=>{const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=ev=>{try{const data=JSON.parse(ev.target.result);const infoDiv=doc.getElementById("roleDetails");infoDiv.innerHTML='<b>Role Type:</b> '+data.roleType+'<br><b>System:</b> '+data.system+'<br><b>Role:</b> '+data.role+'<br><b>Date:</b> '+data.timestamp+'<div id="filterButtons"><button id="filterMismatch">Mismatches</button><button id="filterPermitted">Permitted</button><button id="filterRestricted">Restricted</button><button id="filterAll">All</button></div>';const rows=doc.querySelectorAll("tbody#listContainer_databody>tr");rows.forEach(tr=>{const name=tr.querySelector("th div")?.innerText.trim();const imgSrc=tr.querySelector("td:nth-child(2) img")?.getAttribute("src")||"";const actualStatus=imgSrc.includes("checkmark")?"permitted":imgSrc.includes("dash")?"inherited":"restricted";if(name&&data.privileges[name]){const expectedStatus=data.privileges[name].status;if(expectedStatus!==actualStatus){const statusCell=tr.querySelector("td:nth-child(2)");if(statusCell){const warnIcon=doc.createElement("span");warnIcon.textContent="⚠️";warnIcon.title="Mismatch: expected "+expectedStatus+", actual "+actualStatus;warnIcon.style.fontSize="18px";warnIcon.style.marginLeft="6px";warnIcon.style.color="orange";statusCell.appendChild(warnIcon)}}}});const filterRows=mode=>{rows.forEach(tr=>{const name=tr.querySelector("th div")?.innerText.trim();const imgSrc=tr.querySelector("td:nth-child(2) img")?.getAttribute("src")||"";const actualStatus=imgSrc.includes("checkmark")?"permitted":imgSrc.includes("dash")?"inherited":"restricted";const expectedStatus=data.privileges[name]?.status;const mismatch=expectedStatus&&expectedStatus!==actualStatus;if(mode==="mismatch")tr.style.display=mismatch?"":"none";else if(mode==="permitted")tr.style.display=expectedStatus==="permitted"&&actualStatus!=="permitted"?"":"none";else if(mode==="restricted")tr.style.display=expectedStatus==="restricted"&&actualStatus!=="restricted"?"":"none";else tr.style.display=""})};doc.getElementById("filterMismatch").onclick=()=>filterRows("mismatch");doc.getElementById("filterPermitted").onclick=()=>filterRows("permitted");doc.getElementById("filterRestricted").onclick=()=>filterRows("restricted");doc.getElementById("filterAll").onclick=()=>filterRows("all");alert("JSON uploaded and mismatches flagged.")}catch(err){alert("Invalid JSON file.")}};reader.readAsText(file)};input.click()})})();
