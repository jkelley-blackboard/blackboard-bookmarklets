javascript:(()=>{const F=document.querySelector('iframe[name="bb-base-admin-iframe"]'),d=F?.contentDocument||document,w=F?.contentWindow||window,qs=new%20URLSearchParams(d.location.search);if(!d.location.pathname.includes(%27/webapps/blackboard/execute/managePrivileges%27)){alert(%27%E2%9A%A0%20Go%20to%20the%20manage%20privileges%20page.%27);return}if(qs.get(%27showAll%27)!==%27true%27){alert(%27%E2%9A%A0%20Show%20All%20is%20required.%20Click%20%22Show%20All%22%20on%20the%20page,%20then%20re-run.%27);return}const%20E=s=%3EString(s).replace(/[&%3C%3E]/g,c=%3E({%27&%27:%27&amp;%27,%27%3C%27:%27&lt;%27,%27%3E%27:%27&gt;%27}[c])),PR=(c,t,h,i)=%3E{const%20b=d.createElement(%27button%27);b.textContent=t;if(i)b.id=i;b.className=%27cmp-btn%27;b.onclick=h;c.appendChild(b)},GN=tr=%3E(tr.querySelector(%27th%20div%27)?.innerText||%27%27).trim(),GS=tr=%3E{const%20i=tr.querySelector(%27td:nth-child(2)%20img%27),a=(i?.alt||%27%27).toLowerCase(),s=(i?.getAttribute(%27src%27)||%27%27).toLowerCase();if(a.includes(%27permit%27)||s.includes(%27check%27))return%27permitted%27;if(a.includes(%27inherit%27)||s.includes(%27dash%27))return%27inherited%27;return%27restricted%27},GE=tr=%3E{const%20th=tr.querySelector(%27th%27)||tr,cb=tr.querySelector(%27input[type=%22checkbox%22][name=%22ckbox%22]%27);if(cb){const%20v=cb.value||%27%27;if(/\w+\.\w+/.test(v))return%20v;const%20m=(cb.id||%27%27).match(/^listContainer_ckbox(.+)$/);if(m&&/\w+\.\w+/.test(m[1]))return%20m[1]}const%20as=[...th.querySelectorAll(%27a[href]%27)];for(const%20a%20of%20as){try{const%20u=new%20URL(a.getAttribute(%27href%27),document.baseURI),p=u.searchParams,ks=[...p.keys()],k=ks.find(x=%3E/entitlement|entl|privilege|privilegeEntitlement|priv|perm|permission|id/i.test(x));if(k){const%20val=p.get(k);if(val&&/\w+\.\w+/.test(val))return%20val}const%20g=u.pathname.split(%27/%27).find(s=%3E/\w+\.\w+/.test(s));if(g)return%20g}catch{}}const%20el=tr.querySelector(%27[data-entitlement],[data-privilege-id]%27),attr=el?.getAttribute(%27data-entitlement%27)||el?.getAttribute(%27data-privilege-id%27);if(attr&&/\w+\.\w+/.test(attr))return%20attr;const%20tok=s=%3E(s&&(s.match(/[a-z][a-z0-9]*(?:\.[a-z0-9]+){1,}/i)||[])[0])||null;const%20t1=tok(tr.id)||tok(tr.className)||tok(th.id)||tok(th.className);if(t1)return%20t1;const%20code=th.querySelector(%27code%27);if(code){const%20t=(code.textContent||%27%27).trim();if(/\w+\.\w+/.test(t)&&t.length%3C=200)return%20t}return%20null},EP=doc=%3E{let%20p=doc.getElementById(%27cmpPanel%27);if(p){p.querySelector(%27#roleTypeWarning').textContent='';p.querySelector('#roleDetails').innerHTML='';const%20f=p.querySelector('#buttonRowFilters');if(f){f.innerHTML='';f.style.display='none'}p.querySelector('#summary').textContent='';p.querySelector('#extras').innerHTML='';return%20p}p=doc.createElement('div');p.id='cmpPanel';p.style.cssText='position:fixed;top:20px;left:20px;z-index:2147483647;background:#fffbe6;border:3px%20solid%20#111;border-radius:8px;padding:12px%2012px%2010px;min-width:380px;max-height:72vh;overflow:auto;box-shadow:0%206px%2018px%20rgba(0,0,0,.25);font:14px/1.35%20system-ui,-apple-system,Segoe%20UI,Roboto,Arial,sans-serif';p.innerHTML='%3Cdiv%20style=%22display:flex;align-items:center;justify-content:space-between;margin-bottom:4px%22%3E%3Cspan%20style=%22font-weight:600%22%3ERole%20Privileges%20Utility%3C/span%3E%3Cbutton%20id=%22cmpClose%22%20class=%22cmp-btn%22%20style=%22background:#111;border-color:#111;color:#fff;padding:2px%208px;border:1px%20solid%20#111;border-radius:6px;cursor:pointer%22%3E%E2%9C%95%3C/button%3E%3C/div%3E%3Cdiv%20id=%22roleTypeWarning%22%20style=%22color:#b91c1c;margin:4px%200%22%3E%3C/div%3E%3Cdiv%20id=%22buttonRowPrimary%22%20style=%22display:flex;gap:6px;flex-wrap:wrap;margin:6px%200%22%3E%3C/div%3E%3Cdiv%20id=%22roleDetails%22%20style=%22border:1px%20solid%20#e5e7eb;background:#ffffff;padding:6px;border-radius:6px;max-height:160px;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,&quot;Liberation%20Mono&quot;,&quot;Courier%20New&quot;,monospace;font-size:12px;line-height:1.4%22%3E%3C/div%3E%3Cdiv%20id=%22buttonRowFilters%22%20style=%22display:flex;gap:6px;margin-top:6px%22%3E%3C/div%3E%3Cdiv%20id=%22summary%22%20style=%22margin-top:6px%22%3E%3C/div%3E%3Cdiv%20id=%22extras%22%20style=%22margin-top:6px%22%3E%3C/div%3E';const%20st=doc.createElement('style');st.textContent='#cmpPanel%20.cmp-srcline{white-space:pre-wrap;word-break:break-word;}#cmpPanel%20button.cmp-btn{margin:0;padding:6px%2010px;font-size:13px;border-radius:6px;border:1px%20solid%20#5b21b6;background:#7c3aed;color:#fff;cursor:pointer;box-shadow:0%201px%202px%20rgba(0,0,0,.06);}#cmpPanel%20button.cmp-btn:hover{filter:brightness(1.05);}#cmpPanel%20.cmp-ent{margin-left:8px;padding:0%206px;font:500%2011px/1%20monospace;color:#374151;background:#f3f4f6;border:1px%20solid%20#e5e7eb;border-radius:4px;vertical-align:baseline;display:inline-block}';p.appendChild(st);((el)=%3E{let%20dx=0,dy=0,sx=0,sy=0,g=false;const%20dn=e=%3E{g=true;sx=e.clientX;sy=e.clientY;e.preventDefault()},mv=e=%3E{if(!g)return;dx=e.clientX-sx;dy=e.clientY-sy;sx=e.clientX;sy=e.clientY;el.style.left=(el.offsetLeft+dx)+'px';el.style.top=(el.offsetTop+dy)+'px'},up=()=%3E{g=false};el.addEventListener('mousedown',dn);doc.addEventListener('mousemove',mv);doc.addEventListener('mouseup',up)})(p);p.querySelector('#cmpClose').onclick=()=%3Ep.remove();p.style.left=(doc.defaultView.innerWidth-p.offsetWidth)/2+'px';doc.body.appendChild(p);return%20p},TENT=doc=%3E{const%20sh=!!doc.body.dataset._cmpShowEnt,rows=[...doc.querySelectorAll('tbody#listContainer_databody%3Etr')];rows.forEach(tr=%3E{const%20th=tr.querySelector('th');if(!th)return;let%20pill=th.querySelector('code.cmp-ent');if(!sh){if(!pill){const%20ent=GE(tr);if(!ent)return;pill=d.createElement('code');pill.className='cmp-ent';pill.textContent=ent;pill.style.cssText='margin-left:8px;padding:0%206px;font:500%2011px/1%20monospace;color:#374151;background:#f3f4f6;border:1px%20solid%20#e5e7eb;border-radius:4px;vertical-align:baseline;display:inline-block';(th.querySelector('div')||th).appendChild(pill)}else%20pill.style.display=''}else%20if(pill)pill.style.display='none'});doc.body.dataset._cmpShowEnt=sh?'':'1'},SFN=s=%3EString(s).replace(/[\\/:*?%22%3C%3E|]+/g,'%20').replace(/\s+/g,'%20').trim(),RNAME=doc=%3E{const%20raw=(doc.querySelector('#pageTitleText')?.textContent||doc.querySelector('h1')?.innerText||doc.title||'').trim();const%20split=(()=%3E{const%20i1=raw.indexOf(':'),i2=raw.indexOf('%EF%BC%9A');const%20i=(i1%3E=0&&i2%3E=0)?Math.min(i1,i2):(i1%3E=0?i1:i2);return%20i%3E=0?raw.slice(i+1).trim():raw})();let%20role=split||'Role';const%20ty=(new%20URLSearchParams(doc.location.search).get('type')||'').toLowerCase();if(/^(course|organization)/.test(ty))%20role=role.replace(/[\/\\:*?%22%3C%3E|]/g,'_').replace(/__+/g,'_').replace(/^_+|_+$/g,'');return%20role||'Role'},BBV=doc=%3E{const%20m=doc.querySelector('meta[name=%22bb-version%22]')?.getAttribute('content');if(m)return%20m;const%20f=[...doc.querySelectorAll('footer,#pageFooter,.pageFooter')].map(e=%3Ee.innerText).join('%20'),mm=f.match(/(Build|Version)\s*[:#]?\s*([0-9.]+(?:-[a-z.0-9]+)?)/i);return(mm&&mm[2])||undefined},BDJ=doc=%3E{const%20rows=[...doc.querySelectorAll('tbody#listContainer_databody%3Etr')],priv={};let%20miss=0;rows.forEach(tr=%3E{const%20nm=GN(tr);if(!nm)return;const%20sr=GS(tr),st=sr==='inherited'?'permitted':sr,ent=GE(tr);if(ent)priv[ent]={status:st,name:nm};else%20miss++});return{data:{source:{roleType:(new%20URLSearchParams(doc.location.search).get('type')||'System'),bbDeployment:doc.location.host,role:RNAME(doc),timestamp:new%20Date().toISOString(),bbVersion:BBV(doc)||undefined},privileges:priv},missingEnt:miss}},TD=(doc,data)=%3E{const%20rt=data?.source?.roleType||'Role',rn=data?.source?.role||'Role',ts=(data?.source?.timestamp||new%20Date().toISOString()).replace(/[:.]/g,''),fn=%60bb_role_${SFN(rt)}_${SFN(rn)}_${ts}.json%60,bl=new%20Blob([JSON.stringify(data)],{type:'application/json'}),a=d.createElement('a');a.href=URL.createObjectURL(bl);a.download=fn;d.body.appendChild(a);a.click();setTimeout(()=%3E{URL.revokeObjectURL(a.href);a.remove()},0)},RSL=(doc,p,d)=%3E{const%20box=p.querySelector('#roleDetails'),s=d?.source;if(s&&typeof%20s==='object'){box.innerHTML='%3Cdiv%20style=%22font-weight:600;margin-bottom:4px%22%3ESOURCE%3C/div%3E'+Object.entries(s).map(([k,v])=%3E%60%3Cdiv%20class=%22cmp-srcline%22%3E${E(k)}%20=%20${E(typeof%20v==='object'?JSON.stringify(v):String(v))}%3C/div%3E%60).join('')}else%20box.innerHTML='%3Cdiv%20style=%22font-weight:600;margin-bottom:4px%22%3ESOURCE%3C/div%3E(no%20%22source%22%20object%20found%20in%20JSON)'},VRT=(doc,p,d)=%3E{const%20pg=(new%20URLSearchParams(doc.location.search).get('type')||''),sr=(d?.source?.roleType||'');if(pg&&sr&&pg.toLowerCase()!==sr.toLowerCase()){const%20m=%60Role%20type%20mismatch:%20JSON%20is%20%22${d?.source?.roleType}%22,%20but%20this%20page%20is%20%22${pg}%22.%20Open%20the%20correct%20Manage%20Privileges%20page.%60;p.querySelector('#roleTypeWarning').textContent=m;alert('%E2%9A%A0%20'+m);return%20false}p.querySelector('#roleTypeWarning').textContent='';return%20true},isEnt=k=%3E/^[a-z][a-z0-9]*(\.[a-z0-9]+)+$/i.test(k),reqEnt=o=%3E{const%20bad=[];for(const%20k%20in%20o){if(!isEnt(k)){bad.push(k);if(bad.length%3E=5)break}}if(bad.length)throw%20new%20Error('JSON%20privileges%20must%20be%20entitlement-keyed.%20Examples:%20'+bad.join(',%20'))},GMC=doc=%3Edoc.querySelector('table.list%20thead%20input[type=%22checkbox%22]');let%20SA=null;const%20setSAM=(doc,mode)=%3E{const%20M=GMC(doc);if(!M)return;if(mode==='visible'){if(!SA){SA=e=%3E{e.preventDefault();e.stopImmediatePropagation();e.stopPropagation();const%20c=!M.checked;M.checked=c;[...doc.querySelectorAll('tbody#listContainer_databody%3Etr')].filter(r=%3Er.style.display!=='none').forEach(r=%3E{const%20cb=r.querySelector('input[type=%22checkbox%22]');if(cb)cb.checked=c})};M.dataset._cmpTitle=M.title||''}M.title='Select%20only%20visible%20rows%20(filters%20active)';M.addEventListener('click',SA,true)}else{if(SA)M.removeEventListener('click',SA,true);if(M.dataset._cmpTitle!==undefined){M.title=M.dataset._cmpTitle;delete%20M.dataset._cmpTitle}}},RUN=(doc,p,data)=%3E{const%20rows=[...doc.querySelectorAll('tbody#listContainer_databody%3Etr')],byEnt=data?.privileges||{},pgE=new%20Set();let%20mis=0,ep=0,er=0;rows.forEach(tr=%3E{const%20ent=GE(tr);if(ent)pgE.add(ent);const%20td=tr.querySelector('td:nth-child(2)'),ar=GS(tr),a=ar==='inherited'?'permitted':ar,ex=ent?byEnt[ent]?.status:undefined;if(ex==='permitted')ep++;else%20if(ex==='restricted')er++;const%20old=td?.querySelector('.cmpWarn');if(old)old.remove();if(ex&&ex!==a&&td){mis++;const%20s=d.createElement('span');s.className='cmpWarn';s.innerHTML='%E2%9A%A0';s.style.cssText='font-size:20px;color:#f1c40f;margin-left:6px;vertical-align:middle;';s.title=ex==='permitted'&&a==='restricted'?'Source%20is%20Permitted':ex==='restricted'&&a==='permitted'?'Source%20is%20Restricted':'Mismatch';td.appendChild(s)}});const%20filters=p.querySelector('#buttonRowFilters'),extras=p.querySelector('#extras');extras.innerHTML='';const%20msg=d.createElement('div');msg.style.marginTop='4px';extras.appendChild(msg);const%20apply=m=%3E{rows.forEach(tr=%3E{const%20ent=GE(tr),ar=GS(tr),a=ar==='inherited'?'permitted':ar,ex=ent?byEnt[ent]?.status:undefined,mm=!!(ex&&ex!==a),mp=ex==='permitted'&&a==='restricted',mr=ex==='restricted'&&a==='permitted';let%20sh=true;if(m==='mismatch')sh=mm;else%20if(m==='permit')sh=mp;else%20if(m==='restrict')sh=mr;else%20sh=true;tr.style.display=sh?'':'none'});if(m==='all'){setSAM(doc,'normal');msg.textContent=''}else{setSAM(doc,'visible');msg.textContent='Select%20All%20now%20affects%20only%20visible%20rows.'}};filters.innerHTML='';['Mismatch','Permit','Restrict','Show%20All'].forEach((t,i)=%3EPR(filters,t,()=%3Eapply(i===0?'mismatch':i===1?'permit':i===2?'restrict':'all')));p.querySelector('#summary').innerHTML=%60Found%20%3Cb%3E${mis}%3C/b%3E%20mismatches.%20Expected:%20%3Cb%3E${ep}%3C/b%3E%20permitted,%20%3Cb%3E${er}%3C/b%3E%20restricted.%60;const%20jE=new%20Set(Object.keys(byEnt||{})),onlyJ=[...jE].filter(x=%3E!pgE.has(x)),onlyP=[...pgE].filter(x=%3E!jE.has(x)),fmt=a=%3Ea.slice(0,50).map(E).join(',%20')+(a.length%3E50?'%20%E2%80%A6':'');if(onlyJ.length){const%20d1=d.createElement('div');d1.innerHTML=%60**In%20JSON%20but%20not%20on%20page%20(by%20entitlement,%20${onlyJ.length}):**%20${fmt(onlyJ)}\n%60;extras.appendChild(d1)}if(onlyP.length){const%20d2=d.createElement('div');d2.innerHTML=%60**On%20page%20but%20not%20in%20JSON%20(by%20entitlement,%20${onlyP.length}):**%20${fmt(onlyP)}\n%60;extras.appendChild(d2)}alert('JSON%20uploaded%20and%20mismatches%20flagged.')};const%20panel=EP(d),prim=panel.querySelector('#buttonRowPrimary');if(!prim.dataset._init){PR(prim,'Toggle%20Entitlements',()=%3E{TENT(d)},'btnToggleEnt');PR(prim,'Download%20JSON',()=%3E{try{const%20r=BDJ(d);panel.querySelector('#roleDetails').innerHTML=Object.entries(r.data.source).map(([k,v])=%3E%60%3Cdiv%20class=%22cmp-srcline%22%3E${E(k)}%20=%20${E(String(v))}%3C/div%3E%60).join('');if(r.missingEnt)alert(%60%E2%84%B9%20${r.missingEnt}%20privilege(s)%20had%20no%20detectable%20entitlement%20and%20were%20omitted%20from%20JSON.%60);TD(d,r.data)}catch(e){alert('Download%20failed:%20'+(e?.message||e))}},'btnDownload');PR(prim,'Upload%20JSON%20(Compare)',()=%3E{const%20inp=d.createElement('input');inp.type='file';inp.accept='.json,application/json';inp.onchange=e=%3E{const%20f=e.target.files&&e.target.files[0];if(!f)return;const%20r=new%20FileReader();r.onload=x=%3E{let%20j;try{j=JSON.parse(String(x.target.result||'{}'))}catch(err){alert('JSON%20parse%20error:%20'+(err?.message||err));return}if(!j||typeof%20j!=='object'){alert('JSON%20must%20be%20an%20object%20with%20a%20%22privileges%22%20map.');return}if(!j.privileges||typeof%20j.privileges!=='object'){alert('JSON%20missing%20%22privileges%22%20object.');return}try{reqEnt(j.privileges)}catch(err){alert(err?.message||err);return}if(!VRT(d,panel,j))return;try{RSL(d,panel,j);RUN(d,panel,j)}catch(err){console.error(err);alert('Compare%20failed:%20'+(err?.message||err))}};r.readAsText(f)};inp.click()},'btnUpload');PR(prim,'Refresh%20Page',()=%3E{(F?.contentWindow||window).location.reload()},'btnRefresh');prim.dataset._init='1'}})();